import React, { useState, useEffect } from "react";

import searchicon from "../../assets/dashboard/search.png";
import togglebutton from "../../assets/dashboard/togglebutton.png";
import navlog from "../../assets/Images/nav-log.png";
import profilePIC from "../../assets/dashboard/Profilepic.png";
import Dropdown from "react-bootstrap/Dropdown";
import { Link } from "react-router-dom";
import { useNavigate } from "react-router-dom";
import { useLocation } from "react-router-dom";

import { toast, ToastContainer } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";
import { baseurl } from "../../BaseUrl";
import axios from "axios";

// import Drop2 from '../drop-dwon/Drop2';
const DashboardHeader = ({ onProfileUpdate }) => {
  const navigate = useNavigate();
  const location = useLocation();

  const getUserFromLocalStorage = () => {
    const user = localStorage.getItem("userData");
    return user ? JSON.parse(user) : null;
  };

  const user = getUserFromLocalStorage();

  console.log("User", user);
  if (!user || !user._id) {
    console.error("User ID not found in local storage");
    throw new Error("User ID not found in local storage");
  }

  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [profileData, setProfileData] = useState("");


  useEffect(() => {
    const user = localStorage.getItem("UserId");
    if (user) {
      setIsAuthenticated(true);
    }
    fetchProfileData();

    if (onProfileUpdate) {
      fetchProfileData();
    }
  }, [user._id, onProfileUpdate]); // Added dependency array to run the effect only once

  const fetchProfileData = async () => {
    try {
      const response = await axios.get(
        `${baseurl}/Vendor_getProfile/${user._id}`
      );
      setProfileData(response.data);
    } catch (error) {
      console.error("Error fetching profile data:", error);
      toast.error("Error fetching profile data");
    }
  };

  const handleLogout = () => {
    // Clear the user ID from local storage
    localStorage.removeItem("UserId");
    localStorage.removeItem("userData");

    setIsAuthenticated(false);

    toast.success("You have been logged out successfully!");

    navigate("/");

    // Prevent navigation back to the protected page
    setTimeout(() => {
      window.location.reload(); // Reload the page to clear history
    }, 100); // Timeout to allow toast to show before reload
  };
  return (
    <>
      <ToastContainer />
      <div className="Dash--Header--main">
        <div className="dash--header-logo-serach">
          <div className="logoHeader">
            <Link
              to=""
              className="none-list"
              onClick={() => handleChangeIndex(0)}
            >
              <img src={navlog} alt="" />
            </Link>
          </div>

          <div className="Header--center">
            {location.pathname ===
            "/Multistepmain/profile/basic-info" ? null : (
              <div className="searchbar">
                <input type="text" name="text" placeholder="Search" />
                <img src={searchicon} alt="searchicon" />
              </div>
            )}
          </div>
        </div>

        {/* <div className="commentsicon">
                        <img src={CommentsIcon} alt="CommentsIcon" />
                    </div>

                    <div className="bellicon">
                        <img src={Bellicon} alt="Bellicon" />
                    </div> */}

        <div className="Header--end">
          {/* <div className="profilepic">
                        <img src={profilePIC} alt="profilePIC" />
                     <Drop2/>


                     
                    </div> */}

          <Dropdown>
            <Dropdown.Toggle variant="success" id="dropdown-basic">
              <div className="profilepic">
                <img
                  src={profileData.ProfileImage || profilePIC}
                  alt="profilePIC"
                />
                <h5>{profileData.Username || "John Smith"}</h5>
              </div>

              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="21"
                height="12"
                viewBox="0 0 21 12"
                fill="none"
              >
                <path
                  d="M10.5 12C10.2559 12 10.0116 11.9023 9.82518 11.707L0.279741 1.70705C-0.093247 1.31631 -0.093247 0.683559 0.279741 0.293061C0.652729 -0.097437 1.25672 -0.097687 1.62947 0.293061L10.5 9.58601L19.3706 0.293061C19.7436 -0.097687 20.3476 -0.097687 20.7203 0.293061C21.0931 0.683809 21.0933 1.31656 20.7203 1.70705L11.1749 11.707C10.9885 11.9023 10.7442 12 10.5 12Z"
                  fill="#FF7F47"
                />
              </svg>
            </Dropdown.Toggle>

            <Dropdown.Menu>
              {/* <Dropdown.Item href="Multistepmain/profile"> <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13" fill="none">
                                <path d="M11.6487 11.6447C11.6487 8.20924 11.6487 4.78393 11.6487 1.35189C9.71059 1.35189 7.77919 1.35189 5.82759 1.35189C5.82759 1.5742 5.83096 1.79652 5.82684 2.01846C5.81823 2.47357 5.39752 2.78983 4.96707 2.66071C4.70169 2.58136 4.51679 2.39647 4.49807 2.12475C4.4715 1.73514 4.45952 1.33767 4.50593 0.951047C4.57443 0.378416 5.04455 0.00190129 5.62584 0.00115275C7.2649 -0.000718596 8.90397 0.00040421 10.5427 0.00040421C10.9724 0.00040421 11.4017 -0.000718596 11.8314 0.000778479C12.5163 0.00264982 12.9996 0.479842 12.9996 1.16139C13.0007 4.71918 13.0007 8.27698 12.9996 11.8352C12.9992 12.5182 12.5178 12.9991 11.8351 12.9995C9.77122 13.0006 7.70733 13.001 5.64343 12.9995C4.96819 12.9991 4.48647 12.5174 4.4831 11.8449C4.4816 11.5649 4.48123 11.2846 4.4831 11.0043C4.48609 10.6098 4.77767 10.3104 5.15572 10.3104C5.53414 10.3108 5.82347 10.6094 5.82721 11.0054C5.82909 11.215 5.82759 11.4246 5.82759 11.6447C7.76946 11.6447 9.70385 11.6447 11.6487 11.6447Z" fill="black" />
                                <path d="M8.01645 7.17254C7.92849 7.17254 7.8787 7.17254 7.82892 7.17254C5.45698 7.17254 3.0854 7.17291 0.713459 7.17216C0.299482 7.17179 -0.00407593 6.87986 4.13827e-05 6.49099C0.00378439 6.14143 0.283387 5.84837 0.633359 5.82891C0.684638 5.82592 0.735917 5.82742 0.787571 5.82742C3.13594 5.82742 5.48467 5.82742 7.83304 5.82742C7.88245 5.82742 7.93148 5.82742 8.00671 5.82742C7.95618 5.77315 7.92661 5.73909 7.89517 5.70765C7.47296 5.28473 7.04776 4.8648 6.62891 4.4385C6.3961 4.20159 6.3669 3.85352 6.54357 3.59079C6.71875 3.33029 7.05861 3.21839 7.34607 3.34115C7.44189 3.38194 7.5336 3.44819 7.60808 3.52192C8.43604 4.34456 9.26137 5.16983 10.0852 5.99659C10.3891 6.30124 10.3895 6.69759 10.0856 7.00225C9.26137 7.82863 8.43641 8.65427 7.60958 9.47803C7.31388 9.77258 6.89616 9.78007 6.62367 9.50311C6.35642 9.23176 6.37027 8.81895 6.65998 8.52777C7.10091 8.08463 7.54445 7.64374 8.01645 7.17254Z" fill="black" />
                            </svg> Profile</Dropdown.Item> */}

              {location.pathname === "/Multistepmain/profile/basic-info" ? (
                <Dropdown.Item  href={user.type === "Admin" ? "/Admin_dashboard" : "/dashboard"}>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="13"
                    height="13"
                    viewBox="0 0 13 13"
                    fill="none"
                  >
                    <path
                      d="M11.6487 11.6447C11.6487 8.20924 11.6487 4.78393 11.6487 1.35189C9.71059 1.35189 7.77919 1.35189 5.82759 1.35189C5.82759 1.5742 5.83096 1.79652 5.82684 2.01846C5.81823 2.47357 5.39752 2.78983 4.96707 2.66071C4.70169 2.58136 4.51679 2.39647 4.49807 2.12475C4.4715 1.73514 4.45952 1.33767 4.50593 0.951047C4.57443 0.378416 5.04455 0.00190129 5.62584 0.00115275C7.2649 -0.000718596 8.90397 0.00040421 10.5427 0.00040421C10.9724 0.00040421 11.4017 -0.000718596 11.8314 0.000778479C12.5163 0.00264982 12.9996 0.479842 12.9996 1.16139C13.0007 4.71918 13.0007 8.27698 12.9996 11.8352C12.9992 12.5182 12.5178 12.9991 11.8351 12.9995C9.77122 13.0006 7.70733 13.001 5.64343 12.9995C4.96819 12.9991 4.48647 12.5174 4.4831 11.8449C4.4816 11.5649 4.48123 11.2846 4.4831 11.0043C4.48609 10.6098 4.77767 10.3104 5.15572 10.3104C5.53414 10.3108 5.82347 10.6094 5.82721 11.0054C5.82909 11.215 5.82759 11.4246 5.82759 11.6447C7.76946 11.6447 9.70385 11.6447 11.6487 11.6447Z"
                      fill="black"
                    />
                    <path
                      d="M8.01645 7.17254C7.92849 7.17254 7.8787 7.17254 7.82892 7.17254C5.45698 7.17254 3.0854 7.17291 0.713459 7.17216C0.299482 7.17179 -0.00407593 6.87986 4.13827e-05 6.49099C0.00378439 6.14143 0.283387 5.84837 0.633359 5.82891C0.684638 5.82592 0.735917 5.82742 0.787571 5.82742C3.13594 5.82742 5.48467 5.82742 7.83304 5.82742C7.88245 5.82742 7.93148 5.82742 8.00671 5.82742C7.95618 5.77315 7.92661 5.73909 7.89517 5.70765C7.47296 5.28473 7.04776 4.8648 6.62891 4.4385C6.3961 4.20159 6.3669 3.85352 6.54357 3.59079C6.71875 3.33029 7.05861 3.21839 7.34607 3.34115C7.44189 3.38194 7.5336 3.44819 7.60808 3.52192C8.43604 4.34456 9.26137 5.16983 10.0852 5.99659C10.3891 6.30124 10.3895 6.69759 10.0856 7.00225C9.26137 7.82863 8.43641 8.65427 7.60958 9.47803C7.31388 9.77258 6.89616 9.78007 6.62367 9.50311C6.35642 9.23176 6.37027 8.81895 6.65998 8.52777C7.10091 8.08463 7.54445 7.64374 8.01645 7.17254Z"
                      fill="black"
                    />
                  </svg>
                  Dashboard
                </Dropdown.Item>
              ) : (
                <Dropdown.Item href="/Multistepmain/profile">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="13"
                    height="13"
                    viewBox="0 0 13 13"
                    fill="none"
                  >
                    <path
                      d="M11.6487 11.6447C11.6487 8.20924 11.6487 4.78393 11.6487 1.35189C9.71059 1.35189 7.77919 1.35189 5.82759 1.35189C5.82759 1.5742 5.83096 1.79652 5.82684 2.01846C5.81823 2.47357 5.39752 2.78983 4.96707 2.66071C4.70169 2.58136 4.51679 2.39647 4.49807 2.12475C4.4715 1.73514 4.45952 1.33767 4.50593 0.951047C4.57443 0.378416 5.04455 0.00190129 5.62584 0.00115275C7.2649 -0.000718596 8.90397 0.00040421 10.5427 0.00040421C10.9724 0.00040421 11.4017 -0.000718596 11.8314 0.000778479C12.5163 0.00264982 12.9996 0.479842 12.9996 1.16139C13.0007 4.71918 13.0007 8.27698 12.9996 11.8352C12.9992 12.5182 12.5178 12.9991 11.8351 12.9995C9.77122 13.0006 7.70733 13.001 5.64343 12.9995C4.96819 12.9991 4.48647 12.5174 4.4831 11.8449C4.4816 11.5649 4.48123 11.2846 4.4831 11.0043C4.48609 10.6098 4.77767 10.3104 5.15572 10.3104C5.53414 10.3108 5.82347 10.6094 5.82721 11.0054C5.82909 11.215 5.82759 11.4246 5.82759 11.6447C7.76946 11.6447 9.70385 11.6447 11.6487 11.6447Z"
                      fill="black"
                    />
                    <path
                      d="M8.01645 7.17254C7.92849 7.17254 7.8787 7.17254 7.82892 7.17254C5.45698 7.17254 3.0854 7.17291 0.713459 7.17216C0.299482 7.17179 -0.00407593 6.87986 4.13827e-05 6.49099C0.00378439 6.14143 0.283387 5.84837 0.633359 5.82891C0.684638 5.82592 0.735917 5.82742 0.787571 5.82742C3.13594 5.82742 5.48467 5.82742 7.83304 5.82742C7.88245 5.82742 7.93148 5.82742 8.00671 5.82742C7.95618 5.77315 7.92661 5.73909 7.89517 5.70765C7.47296 5.28473 7.04776 4.8648 6.62891 4.4385C6.3961 4.20159 6.3669 3.85352 6.54357 3.59079C6.71875 3.33029 7.05861 3.21839 7.34607 3.34115C7.44189 3.38194 7.5336 3.44819 7.60808 3.52192C8.43604 4.34456 9.26137 5.16983 10.0852 5.99659C10.3891 6.30124 10.3895 6.69759 10.0856 7.00225C9.26137 7.82863 8.43641 8.65427 7.60958 9.47803C7.31388 9.77258 6.89616 9.78007 6.62367 9.50311C6.35642 9.23176 6.37027 8.81895 6.65998 8.52777C7.10091 8.08463 7.54445 7.64374 8.01645 7.17254Z"
                      fill="black"
                    />
                  </svg>
                  Profile
                </Dropdown.Item>
              )}

              <Dropdown.Item href="/">
                {" "}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="13"
                  height="13"
                  viewBox="0 0 13 13"
                  fill="none"
                >
                  <path
                    d="M11.6487 11.6447C11.6487 8.20924 11.6487 4.78393 11.6487 1.35189C9.71059 1.35189 7.77919 1.35189 5.82759 1.35189C5.82759 1.5742 5.83096 1.79652 5.82684 2.01846C5.81823 2.47357 5.39752 2.78983 4.96707 2.66071C4.70169 2.58136 4.51679 2.39647 4.49807 2.12475C4.4715 1.73514 4.45952 1.33767 4.50593 0.951047C4.57443 0.378416 5.04455 0.00190129 5.62584 0.00115275C7.2649 -0.000718596 8.90397 0.00040421 10.5427 0.00040421C10.9724 0.00040421 11.4017 -0.000718596 11.8314 0.000778479C12.5163 0.00264982 12.9996 0.479842 12.9996 1.16139C13.0007 4.71918 13.0007 8.27698 12.9996 11.8352C12.9992 12.5182 12.5178 12.9991 11.8351 12.9995C9.77122 13.0006 7.70733 13.001 5.64343 12.9995C4.96819 12.9991 4.48647 12.5174 4.4831 11.8449C4.4816 11.5649 4.48123 11.2846 4.4831 11.0043C4.48609 10.6098 4.77767 10.3104 5.15572 10.3104C5.53414 10.3108 5.82347 10.6094 5.82721 11.0054C5.82909 11.215 5.82759 11.4246 5.82759 11.6447C7.76946 11.6447 9.70385 11.6447 11.6487 11.6447Z"
                    fill="black"
                  />
                  <path
                    d="M8.01645 7.17254C7.92849 7.17254 7.8787 7.17254 7.82892 7.17254C5.45698 7.17254 3.0854 7.17291 0.713459 7.17216C0.299482 7.17179 -0.00407593 6.87986 4.13827e-05 6.49099C0.00378439 6.14143 0.283387 5.84837 0.633359 5.82891C0.684638 5.82592 0.735917 5.82742 0.787571 5.82742C3.13594 5.82742 5.48467 5.82742 7.83304 5.82742C7.88245 5.82742 7.93148 5.82742 8.00671 5.82742C7.95618 5.77315 7.92661 5.73909 7.89517 5.70765C7.47296 5.28473 7.04776 4.8648 6.62891 4.4385C6.3961 4.20159 6.3669 3.85352 6.54357 3.59079C6.71875 3.33029 7.05861 3.21839 7.34607 3.34115C7.44189 3.38194 7.5336 3.44819 7.60808 3.52192C8.43604 4.34456 9.26137 5.16983 10.0852 5.99659C10.3891 6.30124 10.3895 6.69759 10.0856 7.00225C9.26137 7.82863 8.43641 8.65427 7.60958 9.47803C7.31388 9.77258 6.89616 9.78007 6.62367 9.50311C6.35642 9.23176 6.37027 8.81895 6.65998 8.52777C7.10091 8.08463 7.54445 7.64374 8.01645 7.17254Z"
                    fill="black"
                  />
                </svg>{" "}
                Home
              </Dropdown.Item>

              <Dropdown.Item onClick={handleLogout}>
                {" "}
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="13"
                  height="13"
                  viewBox="0 0 13 13"
                  fill="none"
                >
                  <path
                    d="M11.6487 11.6447C11.6487 8.20924 11.6487 4.78393 11.6487 1.35189C9.71059 1.35189 7.77919 1.35189 5.82759 1.35189C5.82759 1.5742 5.83096 1.79652 5.82684 2.01846C5.81823 2.47357 5.39752 2.78983 4.96707 2.66071C4.70169 2.58136 4.51679 2.39647 4.49807 2.12475C4.4715 1.73514 4.45952 1.33767 4.50593 0.951047C4.57443 0.378416 5.04455 0.00190129 5.62584 0.00115275C7.2649 -0.000718596 8.90397 0.00040421 10.5427 0.00040421C10.9724 0.00040421 11.4017 -0.000718596 11.8314 0.000778479C12.5163 0.00264982 12.9996 0.479842 12.9996 1.16139C13.0007 4.71918 13.0007 8.27698 12.9996 11.8352C12.9992 12.5182 12.5178 12.9991 11.8351 12.9995C9.77122 13.0006 7.70733 13.001 5.64343 12.9995C4.96819 12.9991 4.48647 12.5174 4.4831 11.8449C4.4816 11.5649 4.48123 11.2846 4.4831 11.0043C4.48609 10.6098 4.77767 10.3104 5.15572 10.3104C5.53414 10.3108 5.82347 10.6094 5.82721 11.0054C5.82909 11.215 5.82759 11.4246 5.82759 11.6447C7.76946 11.6447 9.70385 11.6447 11.6487 11.6447Z"
                    fill="black"
                  />
                  <path
                    d="M8.01645 7.17254C7.92849 7.17254 7.8787 7.17254 7.82892 7.17254C5.45698 7.17254 3.0854 7.17291 0.713459 7.17216C0.299482 7.17179 -0.00407593 6.87986 4.13827e-05 6.49099C0.00378439 6.14143 0.283387 5.84837 0.633359 5.82891C0.684638 5.82592 0.735917 5.82742 0.787571 5.82742C3.13594 5.82742 5.48467 5.82742 7.83304 5.82742C7.88245 5.82742 7.93148 5.82742 8.00671 5.82742C7.95618 5.77315 7.92661 5.73909 7.89517 5.70765C7.47296 5.28473 7.04776 4.8648 6.62891 4.4385C6.3961 4.20159 6.3669 3.85352 6.54357 3.59079C6.71875 3.33029 7.05861 3.21839 7.34607 3.34115C7.44189 3.38194 7.5336 3.44819 7.60808 3.52192C8.43604 4.34456 9.26137 5.16983 10.0852 5.99659C10.3891 6.30124 10.3895 6.69759 10.0856 7.00225C9.26137 7.82863 8.43641 8.65427 7.60958 9.47803C7.31388 9.77258 6.89616 9.78007 6.62367 9.50311C6.35642 9.23176 6.37027 8.81895 6.65998 8.52777C7.10091 8.08463 7.54445 7.64374 8.01645 7.17254Z"
                    fill="black"
                  />
                </svg>
                LOGOUT
              </Dropdown.Item>
            </Dropdown.Menu>
          </Dropdown>
        </div>
      </div>
    </>
  );
};

export default DashboardHeader;
